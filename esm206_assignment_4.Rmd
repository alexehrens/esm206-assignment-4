---
title: "ESM 206 Assignment 4 - Spiny Lobsters"
author: "Alex Ehrens & Courtney Krone"
date: "11/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(janitor)
library(tidyr)
library(here)
library(effsize)
library(kableExtra)
library(directlabels)
library(ggridges)
```

```{r}
lobster_abundance <- read.csv("lobster_abundance_sbc_lter.csv",
                              na = -99999) %>% 
  clean_names() %>% 
  mutate(site = as.character(site))

lobster_abundance$site[lobster_abundance$site == "IVEE"] <- "Isla Vista"
lobster_abundance$site[lobster_abundance$site == "NAPL"] <- "Naples"
lobster_abundance$site[lobster_abundance$site == "AQUE"] <- "Arroyo Quemado"
lobster_abundance$site[lobster_abundance$site == "CARP"] <- "Carpinteria"
lobster_abundance$site[lobster_abundance$site == "MOHK"] <- "Mohawk"
```

### 1. Introduction


### 2. Data and Methods


### 3. Results

#### a. Results A
IVEE and NAPL - MPA
AQUE, CARP and MOHK - Non-MPA
- Need to change color and show between MPA and NonMPA sites

```{r}
lobster_count <- lobster_abundance %>% 
  group_by(year, site) %>% 
  summarize(total_counts = sum(count)) %>% 
  mutate(category = ifelse(site %in% c("Isla Vista", "Naples"), "MPA", "Non-MPA")) %>% 
  mutate(Site = site)
  
ggplot(lobster_count, aes(x = year, y = total_counts)) +
  geom_line(aes(color = Site)) +
  theme_bw() +
  theme(legend.position = c(0.23, 0.65),
        legend.background = element_rect(fill = "transparent"),
        legend.key.size = unit(5, "mm")) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 1000),
                     expand = c(0,0)) +
  labs(x = "Year (2012-2018)",
       y = "Total lobster counts",
       title = "Yearly lobster counts at each survey site (2012-2018)",
       subtitle = "Source: SBC LTER",
       caption = "Lobster abundance increased between 2012 and 2018  for most of the sites excluding AQUE site. The MPA sites (IVEE and NAPL) lobster abundance grew substantially over the recorded years compared to non-MPA sites")

### Change color scheme, theme, etc...
```

In general, the total lobster abundance at each of the 5 survey sites have increased from 2012 to 2018. However, the only two sites to show an increase in abundance over the final year of study (2017 to 2018) are Isla Vista and Naples, both of these sites are located in Marine Protected Areas. The three sites that are not in Marine Protected Areas show a decrease in total lobster abundance over the final year of the survey. It appears from the trends in Figure 1 that designated Marine Protected Areas help improve lobster abundance in those areas.

#### b. Results B

```{r}
lobster_size <- lobster_abundance %>% 
  filter(year %in% c("2012", "2018")) %>% 
  uncount(count) %>% 
  mutate(Year = as.character(year))

ggplot(lobster_size, aes(y = Year, x = size_mm, fill = Year, color = Year)) +
  geom_density_ridges(color = "gray40") +
  facet_wrap(~site) +
  theme_bw() +
  scale_y_discrete(expand = c(0,0)) +
  theme(legend.position = c(0.84, 0.25)) +
  labs(y = "Year",
       x = "Lobster Size (mm)",
       title = "Lobster size distribution for each site in 2012 and 2018",
       subtitle = "Source: SBC LTER")
  
### make jitter points smaller and more transparent, change color of boxplots, adjust theme, make beautiful, etc...
  
```

#### c. Results C

```{r}
lobster_compare <- lobster_size %>% 
  mutate(site_category = if_else(site %in% c("Naples", "Isla Vista"), "MPA", "Non-MPA")) %>% 
  select(year, site, size_mm, site_category)

lobster_summary <- lobster_compare %>% 
  group_by(year, site_category) %>% 
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    lobster_number = n()) 

# summary table of lobster statistics 
lobster_summary %>% 
  kable(digits = 2,
        col.names = c("Year",
                      "MPA or Non-MPA",
                      "Mean Size (mm)",
                      "Standard Deviation (mm)",
                      "Count")) %>% 
  kable_styling(bootstrap_options = "bordered",
                full_width = TRUE,
                position = "left")

#### start performing two-sample t-tests for 2012 MPA vs. non-MPA, 2018 MPA vs. non-MPA, 2012 MPA vs 2018 MPA, 2012 non-MPA vs 2018 non-MPA
# Lobster sizes for MPA vs. non-MPA sites in 2012

# Create vectors 
lobster2012mpa <- lobster_compare %>% 
  filter(year == "2012") %>% 
  filter(site_category == "MPA") %>% 
  pull(size_mm)

lobster2012nonmpa <- lobster_compare %>% 
  filter(year == "2012") %>% 
  filter(site_category == "Non-MPA") %>% 
  pull(size_mm)

lobster2018mpa <- lobster_compare %>% 
  filter(year == "2018") %>% 
  filter(site_category == "MPA") %>% 
  pull(size_mm)

lobster2018nonmpa <- lobster_compare %>% 
  filter(year == "2018") %>% 
  filter(site_category == "Non-MPA") %>% 
  pull(size_mm)

# t-test comparing mpa and non-mpa sites in 2012
lobster2012_ttest <- t.test(lobster2012mpa, lobster2012nonmpa)
lobster2012_ttest

# t-test comparing mpa and non-mpa sites in 2018
lobster2018_ttest <- t.test(lobster2018mpa, lobster2018nonmpa)
lobster2018_ttest

# t-test comparing mpa sites in 2012 and 2018
lobster_mpa_ttest <- t.test(lobster2012mpa, lobster2018mpa)
lobster_mpa_ttest

# t-test comparing non-mpa sites in 2012 and 2018
lobster_nonmpa_ttest <- t.test(lobster2012nonmpa, lobster2018nonmpa)
lobster_nonmpa_ttest

```

